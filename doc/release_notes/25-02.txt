

              ===============================================
              Release notes for the Genode OS Framework 25.02
              ===============================================

                               Genode Labs



; intro -> @nfeske


Multi-monitor window management and virtual machines
####################################################

With
[https://genode.org/documentation/release-notes/24.11#Multi-monitor_support - version 24.10],
Sculpt OS became usable for mirrored and panoramic multi-monitor setups. In a
panoramic setup, each display shows a portion of a larger panorama maintained
by the nitpicker GUI server. So the displays combined behave like a very large
display. The administrative user interface is already multi-monitor-aware. It
is presented only on the display that hosts the mouse pointer, thereby
ensuring that the entirety of the user interface is reachable at all times,
and to limit the maximum size of the user interface to the resolution of the
largest display (not the total panorama size, which can be much larger).

The current release extends Genode's multi-monitor awareness to the
window manager and its companion components, addressing the interplay
between virtual desktops and physical displays, preserving the reachability
of all applications whenever a display is unplugged, and improving the
usability of interactive window manipulations.


GUI stack
---------

The GUI stack comprises the following components.

[image multi_monitor_wm]

At the bottom, one or more display drivers access the physical displays
attached to the machine. For each display, the driver maintains a distinct
physical frame buffer and creates a capture session at the GUI server.
From the perspective of the GUI server, a display driver appears as a GUI
capturing client. The GUI server maintains a panorama, which is a single 2D
coordinate system where GUI applications are placed. Its configuration
defines which part of the panorama gets exposed to which capture client.
In the example, the eDP capture client obtains the left part whereas
the HDMI capture client obtains the right part.

The window manager (wm) uses the nitpicker GUI server as client and acts
as a GUI server itself, providing the same interface as nitpicker. Sitting
in-between the nitpicker GUI server and the application, it transparently
supplements the notion of windows and virtual desktops.
Among the window-manager clients, two components stand out by having special
roles. The window layouter defines which application is presented at which
part of the panorama by generating a window layout. The window layout is
produced according a rules, which are configurable by the user and are
updated by interactive layout changes like moving a window.
The decorator, in turn,
paints window decorations according to this window layout. Note that neither
the layouter nor the decorator are able to observe information displayed
by the application or any user input directed to the application.

The window layouter introduces the abstraction of virtual desktops named
screens for brevity. Each screen can be assigned to a part of the panorama.
If two screens are assigned to the same part, only the top-most screen
is displayed. In the example, screens 1 to 3 are assigned to the part
captured by the eDP monitor whereas screens 4 to 6 are assigned to the
part captured by the HDMI monitor.

A regular GUI application connected to the window manager only observes
its corresponding display as its virtual panorama. A multi-window application
maintains one GUI session per window. So from the window-manager's
perspective, each window appears as a separate GUI client.


Screen-to-display assignment
----------------------------

The layouter rules can host any number of display declarations as follows.

! <display name="primary"/>

Optional attributes 'xpos', 'ypos', 'width', and 'height' can be specified to
assign a specific rectangle of the panorama to the display. Otherwise, the
window layouter applies the following policy. The captured rectangles present
in the panorama are assigned to displays in left to right order. This gives the
opportunity to assign the notion of a "primary" or "secondary" display to
different parts of the panorama by the mere order of '<display>' nodes. If
more displays are declared than present, all unassigned displays will refer to
the left-most captured rectangle of the panorama.

To get more precise control over the assignment of captured areas to displays,
a display node can host any number of '<capture>' sub nodes that are matched
against the captured areas present within the panorama. The panorama areas are
named after the labels of capture clients (i.e., display drivers) present at
the nitpicker GUI server. The matching can be expressed via the attributes
'label', 'label_prefix', and 'label_suffix'. The first match applies.
E.g., the following configuration may be useful for a laptop that is sometimes
connected to an HDMI display at work or a Display-Port display at home.

! <display name="primary">
!   <capture label_suffix="HDMI-1"/>
!   <capture label_suffix="DP-2"/>
!   <capture label_suffix="eDP-1"/>
! </display>
! <display name="secondary">
!   <capture label_suffix="eDP-1"/>
! </display>

When neither the HDMI-1 display nor the DP-2 display is present, the laptop's
internal eDP display is used as both primary and secondary display. Once an
external display is connected, the external display acts as primary display
while the laptop's internal display takes the role of the secondary display.

Once declared, the display names can be specified as 'display' attribute to
'<screen>' nodes, thereby assigning virtual desktops to displays. Screens
referring to the same portion of the panorama are organized as a stack
where only the top-most screen is visible at a time. As each display has
its own distinct stack of screens, one screen cannot be visible at multiple
displays. To mirror the same content on multiple displays, it is best to
leverage the '<merge>' feature of the display driver. Should a '<screen>' lack
a valid display attribute, it spans the entire panorama.


Improved focus switching and free-arrange layouting
---------------------------------------------------

The switching within the focus history (Super-Tab) is now restricted to
windows that are located at visible screens. This avoids the need to tab
through invisible windows, which is can be confusing when using windows scattered
across several virtual desktops.

Furthermore, the focus is now automatically changed to the most recently
focused visible window whenever the currently focused window becomes
invisible. This happens when switching between virtual desktops. This behavior
hopefully also fits well with focus handling of temporary windows. When a
temporary window appears, it needs to be focused manually (to prevent focus
stealing). But once the temporary window disappears, the focus returns to the
previously focused window.

For interactively moving or resizing a window, the user needed to grab the
corresponding window handles as presented by the decorator. We have now
supplemented the ability to click anywhere within a window while the
wm-modifier key (i.e., Super) is held. Depending on the position within the
window, the click is interpreted as click on the title (when clicking at inner
50% of the window, or as a click on the border (when clicking at an area
nearby the window boundary).

Up until now, the assignment of a window to another screen required a manual
modification of the layouter rules, which was arguably not user friendly. Now,
for screens visible side by side in a multi-monitor setup, one can now move a
window from one screen to another by dragging the window title. When using
screens as virtual desktops on one display, a window can be moved to another
screen by switching the screen (by pressing a key matching a desired screen)
while the window is dragged with the mouse. So the user can drag the window
between virtual desktops.

As an additional convenience, the currently focused window now be taken
to another screen by pressing the wm-modifier key together with shift and
the screen number.


Versioned layouter rules and new defaults
-----------------------------------------

To accommodate the multi-monitor window management, we had to extend the
window-layouter rules. By renaming the rules file to a version number
reflecting the date of change (24.12), we prevent the loss of window-layout
state when switching back and forth between different versions of the
window-layouter.

The default rules contain now the definition of three displays
("primary", "secondary", and "ternary") and map 3 screens to each
display.


Multi-monitor virtual machines
------------------------------

commit 0166291121ab87d0a926182f8c2af3c2e7eeac13
Author: Christian Helmuth <christian.helmuth@genode-labs.com>
Date:   Thu Nov 14 16:44:27 2024 +0100

    vbox6: multi-monitor support
    
    Support dynamic panorama of virtual displays. Virtual monitors for
    VirtualBox must be configured in two steps.
    
    - <Display monitorCount="<num>"> nodes in the .vbox file defines the
      number of _connectors_ and, thus, the maximum number of connected
      virtual monitors.
    
    - Each enabled VirtualBox monitor requests a dedicated GUI session.
      Enablement and labeling of these sessions is done via <monitor>
      nodes in the component configuration like follows.
    
      <monitor label="DP-1"/>
      <monitor label="HDMI-A-1"/>
    
    Labels can be used by the window manager to configure and place the
    corresponding window. The order of the nodes directly controls the
    connection order at the virtual graphics card.
    
    Fixes #5449

commit c7bdc9dced95a9e4c561decfe09dda552420c716
Author: Christian Helmuth <christian.helmuth@genode-labs.com>
Date:   Mon Feb 10 12:27:32 2025 +0100

    Amend vbox6 runtimes / run scripts for monitor config
    
    Issue #5449


Base framework and OS-level infrastructure
##########################################

Init configuration improvements
===============================

; @nfeske

Simplified RAM assignments
--------------------------

In init's configuration, the assignment of RAM to a component is expressed as follows:

! <start name="report_rom">
!   ...
!   <resource name="RAM" quantum="2M"/>
!   ...
! </start>

We have now introduced a new 'ram' attribute as a concise alternative.

! <start name="report_rom" ram="2M">
!   ...
! </start>

This change is complemented with the ability of defining a global default RAM
quota following the existing pattern of the default caps definition, e.g. the
following '<default>' node alleviates the need to repeatedly state reasonable
'ram' and 'caps' values in each single start node.

! <default caps="100" ram="1m"/>


Partial session-label rewriting
-------------------------------

When
[https://genode.org/documentation/genode-foundations/24.05/system_configuration/The_init_component.html#Session_routing - routing]
a session request, a route can be selected by using a label (or a label suffix
or a label prefix) as key.
In the target node ('<parent/>' or '<child name="..."/>'), it is possible to
[https://genode.org/documentation/genode-foundations/24.05/system_configuration/The_init_component.html#Session-label_rewriting - replace]
the label by another one. For example, the following routing rule matches a
ROM session labeled "config". If the route is taken, the session is directed
to the config_fs_rom server and the label is rewritten to "managed/runtime".
So the server will hand out this file as ROM module, which then appears as
"config" at the client.

! <route>
!   ...
!   <service name="ROM" label="config">
!     <child name="config_fs_rom" label="managed/runtime"/> </service>
!   ...
! </route>

In hierarchic scenarios (e.g., nested instances of init), labels assume a form
like "runtime -> system_shell -> terminal -> config". The client's intent (in
this case, the client wants to obtain "config") is successively watermarked by
the components in the chain of authority involved in the session creation.
In the example, the terminal's session request traverses the system-shell init
as well as the runtime init before reaching the server.

In short, the label encodes two things: the expression of the client's intent
(naming a server-provided resource like ROM module), and an unforgeable (by
the client) representation of the client's identity as observed by the server.
The former is the last part of the label whereas the latter are all the
leading parts.

Init's label rewriting mechanism is a useful tool of abstraction, which allows
for grouping clients to roles. However, as the label can only be rewritten as
a whole, the rewriting rule needs to know both the client's identity and the
client's intent. Should the client's intent vary (e.g., a client requesting a
variety of ROM modules), a dedicated rewriting rule is needed for each case.
By introducing the following new attributes for the selective rewriting of
only the identity or the resource part of the label, such policies become much
easier to express.

:'identity="rw"': replaces the identity part of the label by "rw" while
  keeping the resource part. So the client's identity can be replaced by
  a role while keeping the client's intent intact.

:'resource="/bin/"': replaces the client's intent while retaining the
  client's identity. Here, a client's request for a file-system session
  becomes hardwired to one directory of the server.

:'prepend_resource="/usr/local"': prepends the resource part of the label with
  a given prefix. The example restricts the client-provided path to the
  bounds of the server's /usr/local/ directory, as a substitute for the
  traditional chroot component.


Enriched file-system session-label convention
=============================================

Genode 25.02 changes the way of how a client-selected sub directory is
communicated to the file-system server at session-creation time. The former
opaque session argument is now passed as last label element, which allows for
the flexible tweaking of this argument by init's session-routing and
label-rewriting mechanisms. In particular, it alleviates the need for creating
chroot component instances.

This change requires the following four adaptations at the configuration
level:

* Each file-system session request must now carry a path starting
  with / as last session argument. Hence, '<fs>' nodes of the VFS that
  feature a 'label' attribute must extend the attribute value
  with " -> /". For '<fs>' nodes with no label attribute, "/" is
  used as last label argument by default.

* For matching session-routing rules at init's configuration,
  the matching of full labels must be replaced by 'label_prefix'
  matches, excluding the last (path) argument.

* Wherever a label of a file-system session is rewritten by using
  init's 'label' attribute in a '<parent>' or '<child>' target node,
  the new attribute 'identity' should be used instead. This replaces
  the identity part of the label while preserving the client's
  directory argument.

* Analogously to the matching of session-routing rules, server-side
  policy-selection rules that formerly matched a concrete 'label'
  must be changed to match a 'label_prefix' instead.

As a good practice, 'label_prefix' values should end with " ->" if possible,
which clearly delimits the identity part of the label used by the matching.


SIMD optimizations
==================

With screen resolutions growing, the proliferation of multi-monitor setups,
and in anticipation of screen-rotation support later this year, our existing
pixel-shovelling routines show their limitations. This prompted us to
investigate the use of SIMD (single instruction multiple data) for such
purpose, leveraging ARM Neon on the 64-bit ARM architecture and SSE4 on the
64-bit x86 architecture.

We put our attention on two well known bottlenecks, namely the back-to-front
blitting performed by display drivers and alpha blending performed by the
nitpicker GUI server. The existing blit library has been extended by two new
interfaces 'Blit::back2front' and 'Blit::blend_xrgb_a' accommodating these use
cases. With the planned support for screen rotation in the back of our heads,
the 'back2front' implementation supports the rotation by 0, 90, 180, and 270
degrees as well as screen flipping.

Our effort spent on the SIMD optimizations paid off. The new versions improve
the performance roughly by factor 3 compared to our original routines.
Non-SIMD implementations of the same interfaces are available as fallback,
which is employed on 32-bit architectures and RISC-V.


Qt, WebEngine, and Falkon browser
#################################

; @cproc

commit dd64164ed64a11e06cf61b490fc9b10e8eb57cef
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Mon Dec 9 08:36:53 2024 +0100

    qt6: split port into modules
    
    Fixes #5402

commit fe18db4d34df010631c45550ebb73bdfa2a6e217
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Tue Jan 14 14:16:36 2025 +0100

    qt6: add 'SvgWidgets' files
    
    Fixes #5419

commit 6c1af53909f4ab6aa71d2bf8894a27ccdc47a490
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Wed Jan 15 04:22:29 2025 +0100

    qt6: add 'i18n' example
    
    Fixes #5421

commit 9beb47812e07c25e8c86e5e35333e1f8a253ca4f
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Thu Feb 13 14:11:18 2025 +0100

    qt5: move WebEngine-related API recipes to genode-world
    
    Fixes #5452

commit e3f5f16ba4631dfcda58c5f5fe83e986336dd424
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Fri Feb 14 10:04:32 2025 +0100

    qt5: set CMAKE_SHARED_LIBRARY_SONAME_C_FLAG variable
    
    Fixes #5453

commit cc0fa54cbfbe05db7948f7445af86991245278ab
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Fri Feb 14 10:27:11 2025 +0100

    qt: support extra CMake flags
    
    Fixes #5454

commit 060c242afc78546049b7c86c47cbdacccb5ddcc5
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Fri Feb 21 08:44:34 2025 +0100

    qt6: add qt5compat module
    
    Fixes #5458

commit addce529e3a39c481dd713ccb3bd3a9ad9bfee21
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Fri Feb 21 11:25:35 2025 +0100

    qt6: add qtwebchannel and qtwebengine APIs
    
    Fixes #5459

; genode-world.git:

commit ae21e7930fb6f6241b7fa3f8ba4b2f879c9b13f0
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Thu Feb 13 13:34:25 2025 +0100

    Add Qt5WebEngine-related API recipes
    
    Fixes #387

commit 78a4aefe2a3533bed5ad5f742f0da5fdaf4eb7fe
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Sun Sep 8 19:32:43 2024 +0200

    qt5_webengine: add REQUIRES in target.mk
    
    Fixes #388

commit 837d14ba0e8a89f27a19998371cb9a562df3e4b7
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Fri Feb 14 10:47:02 2025 +0100

    falkon: build with CMake
    
    Fixes #389

commit 74533a5f89fed29184835efde4fade53df8bc2a5
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Tue Feb 18 11:45:30 2025 +0100

    falkon: update to version 24.01.75
    
    Fixes #390

commit 229bedf016449a769a842036773ad2787625d303
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Fri Feb 21 11:04:41 2025 +0100

    add Qt6 webchannel and webengine modules
    
    Fixes #391

commit c9f3ca917dd2b702906b5434fc3812b2c8ae198a
Author: Christian Prochaska <christian.prochaska@genode-labs.com>
Date:   Fri Feb 21 15:11:32 2025 +0100

    add Qt6-based Falkon
    
    Fixes #392


Device drivers
##############

User-space IOMMU support for IRQ remapping
==========================================

While adding kernel-agnostic DMA protection in Genode
[https://genode.org/documentation/release-notes/23.11#Kernel-agnostic_DMA_protection - 23.11],
we intentionally left IRQ protection out of scope. This release completes the
kernel-agnostic IOMMU enablement on Intel platforms by adding IRQ-remapping
support to the platform driver.

Since the platform driver already controls the MSI/MSI-X enablement for PCI
devices, setting up the corresponding remapping tables was rather straightforward.
Integrating remapping support for legacy interrupts, however, was a bit more
involved. It required us to also add support for the
_I/O APIC (Advanced Programmable Interrupt Controller)_
to the platform driver. Similar to how the
_DMA Remapping Hardware Unit Defintions_ (DRHDs) are reflected in the _acpi_
report generated by the ACPI driver and added to the _devices_ report by our
PCI decode component, the available I/O APICs are now also part of the _devices_
report. With the added information, the platform driver is able to take over
control of the interrupt controller and set up IRQ remapping unless the
kernel already enabled IRQ remapping. Since the NOVA kernel already implements
IRQ remapping, the platform driver's I/O APIC and IRQ-remapping logic is
only effective on our base-hw kernel.

Note, as a prerequisite for handling IRQ remapping tables, we also needed to switch
from using the register-based invalidation interface to the queued invalidation
interface, which is the new default (if supported by the platform).


Sculpt-OS compatibility with F&S i.MX 8MP armStone
==================================================

During the last six month a lot effort was taken to support additional NXP i.MX
8M Plus centered devices, like the Compulab IOT Gateway and the MNT Pocket
Reform. With the current release, we extend the row of devices capable to run
Sculpt OS by another board featuring this SoC, namely the armStone board from
F&S Embedded.

As it is based on the same SoC, we could re-use most drivers for platform, USB,
MMC, or Ethernet. But to drive the more complex and board specific conglomerate
of display engine and differing connectors (HDMI instead of MIPI-DSI), we ported
an alternative framebuffer driver from the vendor's Linux kernel fork to Genode.

With most peripheral drivers in place, we can now provide another instance of
Sculpt-OS running on top of the armStone board. To facilitate the build of an
SD-card image, you can extend the RUN_OPT variable by:

! RUN_OPT += --include image/armstone_sdcard

This will automatically create an SD-card image, whenever you execute a
run-script for the armStone board, e.g.:

! make run/sculpt_image BOARD=imx8mp_armstone

The resulting SD-card image is not bootable directly, as the board relies on
booting from eMMC. Instead a second-stage loadable u-boot is placed in the
image, which is capable to load our system-image that is slightly too large to
be loaded by the pre-installed bootloader.


USB
===

We addressed a short-coming when selecting USB endpoints, where only the
interface number was considered in the selection process and the alternate
settings number was ignored. Thereby the order in which the interface
descriptors were iterated was accidentally determining the endpoint addresses
that were communicated to the client, i.e. the USB device driver.

In case of mass-storage devices, like external SSDs, the 'usb_block' driver
tried to operate the device with the endpoint addresses belonging to the
USB-Attached-SCSI (UAS) alternate setting rather than the bulk-only interface
it supports.

With the fix that includes the alternate setting number in the selection
process in place the order is now of no consequence and the affected devices
are working again.


Audio
=====

In order to improve user experience, especially with regard to video
conferencing, we extended our [https://www.openbsd.org - OpenBSD] based audio
driver with an option to customize microphone selection. The <config> node of
the audio driver now supports a 'mic_priority' attribute. Supported values are
"internal" and "external" (default). In case two microphones are present, e.g., a
headset and an internal microphone on a notebook, a value of "internal" will
enable the speakers of the headset and the microphone of the notebook, while
"external" will enable the microphone of the headset.


Platforms
#########

Execution on bare hardware (base-hw)
====================================

Genode's custom kernel supports the notion of IPC-helping since the very
beginning. This concept means that one thread calling another one via an
Inter Process Communication (IPC) message, will borrow its own scheduling-abilities to the
target thread. As the caller will block until it gets a response, it is a
nice property to pass its time to the target side, which acts on behalf of
the caller anyway.
This nice concept was originally adopted from the Nova kernel. However, in
contrast to Nova and some other L4-like microkernels, the base-hw kernel does
not use the IPC mechanism to forward page-faults to the pager thread that should
resolve it. Thereby, all scheduling parameters, like priorities and CPU quantums
that we can distribute in the system, are valid across component boundaries when
using RPC, but not in case of page-faults. But this can lead to unwanted
interferences in between components of different priority that depend on the
same pager thread.
Therefore, we have generalized the notion of helping in our custom kernel to
borrow a thread's scheduling properties not only when doing IPC, but also when a
page-fault got triggered. Moreover, there is not only one global pager thread
available anymore, but one pager thread per CPU.

To aid debugging during development of the basic system, e.g.: when adding new
features or new platforms to the kernel, we add additional recognition and
information printing about the hardware state during a fault when executing a
core's thread or kernel context.

; @atopia

commit 89f7834b1752e42aefbd718b85a08da43fb88b2e
Author: Benjamin Lamowski <benjamin.lamowski@genode-labs.com>
Date:   Wed Jan 8 10:45:33 2025 +0100

    hw: calibrate TSC via ACPI timer
    
    To get the Time Stamp Counter's frequency, hw relied on a complex and
    incomplete algorithm.
    
    Since this is a one-time initialization issue, move TSC calibration to
    bootstrap and implement it using the ACPI timer.
    
    Issue #5215

commit ec5e1a6b4b4039cb25987b1784b56ff7ad624e2e
Author: Benjamin Lamowski <benjamin.lamowski@genode-labs.com>
Date:   Thu Jan 9 11:31:42 2025 +0100

    hw: calibrate Local APIC via ACPI timer
    
    Upto now, bootstrap used the Programmable Interval Timer to set a
    suitable divider and determine the frequency of the Local APIC.
    The PIT is not available on recent x86_64 hardware anymore.
    
    Move Local APIC calibration to bootstrap and use the ACPI timer as a
    reference. Clean up hw's timer implementation a little and disable the
    PIT in bootstrap.
    
    Fixes #5215

commit 02b7878229b605a25ea0e21cc5e3e4e2d300b84e
Author: Benjamin Lamowski <benjamin.lamowski@genode-labs.com>
Date:   Tue Jan 21 16:26:52 2025 +0100

    hw: always serialize rdtsc reads
    
    While implementing TSC calibration in #5215, the issue of properly serializing
    TSC reads came up. Some learnings of the discussion were noted in #5430.
    
    Using `cpuid` for serialization as in Trace::timestamp() is portable,
    but will cause VM exits on VMX and SVM and is therefore unsuitable to
    retain a roughly working calibration loop while running virtualized.
    On the other hand on most AMD systems, dispatch serializing `lfence`
    needs to be explicitly enabled via a non-architectural MSR.
    
    Enable setting up dispatch serializing lfence on AMD systems and always
    serialize rdtsc accesses in Hw::Tsc::rdtsc() for maximum reliability.
    
    Issues #5215, #5430



NOVA microhypervisor
====================

With this release we added support to detect and parse x2APIC entries
of the ACPI [https://wiki.osdev.org/MADT - MADT] tables, which contain
information to find and setup all CPUs during initialization of the NOVA
kernel. Even so the x2APIC feature is required actually to support more than
256 CPUs, the actual trigger was a new Intel Meteor Lake based Framework
notebook with 24 CPUs. For this specific notebook however, no MADT entries for
local APIC entries were available, just the x2APIC entries. We used this
circumstance to synchronize and harmonize the local APIC implementation of
the NOVA upstream development with the NOVA version as used by Genode.

Lifted limitations on Fiasco.OC and seL4
========================================

During preparation of the 'Celebrating kernel diversity with Genode' talk
at the open source conference
[https://fosdem.org/2025/schedule/event/fosdem-2025-5768-celebrating-kernel-diversity-with-genode - FOSDEM 2025]
, the Fiasco.OC and seL4 based platforms received several improvements in
order to demo their principal working with Sculpt OS.

The base-foc version got support to be bootable on UEFI based platforms
by extending the core component to lookup and find the initial ACPI RSDP
information. Additionally, the base-foc capability selector management in
Genode got extended to support more capability selectors.

The base-sel4 platform received support to setup and use MSI interrupts for
all devices and associated drivers, which improved the success rate of
Sculpt OS noticeable on modern notebooks.

Finally, all modern kernels, namely NOVA, HW, Fiasco.OC and seL4 are now using
the pre-bootloader feature of bender to enable the
[https://genode.org/documentation/release-notes/22.11#Configurable_Intel_HWP_mode - Intel HWP]
feature during boot time consistently.

Build system and tools
######################

Goa SDK
=======

While working on several ports of 3rd-party software using the Goa SDK, we
further tweaked its support of commodity build systems. This includes the
propagation of shared-library linker flags and the execution of 'make install'
in autoconf-based and make-based projects. Moreover, Goa used to symlink the
complete content from a project's _src/_ directory into the build directory.
As this could create ping-pong effects with generated files, Goa now leaves
generated files untouched (unless provided with the '--rebuild' flag).

Autoconf-based projects are now pointed to the used API archives for looking up
pkg-config files. This prevents pkg-config from accidentally pulling library
information from the host system and instead only take this information from
_*.pc_ files in the referenced depot archives.

Furthermore, we updated the built-in depot archive versions to Sculpt 24.10.3.


Compilation changes
===================

The use of ARM Neon and Intel SSE4 in the context of the SIMD optimizations
mentioned in Section [SIMD optimizations], we encountered two limitations of
our tool chain's default behavior.

First, even though Genode does not depend on the host system's C library (a
few hybrid Genode/Linux components notwithstanding), the tool chain defines
'__STDC_HOSTED__' by default. This becomes a problem when using the ARM-Neon
compiler intrinsics, which rely on the compiler's _stdint.h_, which in turn
expects the presence of a C library whenever '__STDC_HOSTED__' is set. To
discharge this wrong expectation, we explicitly specify the '-ffreestanding'
compiler argument by default now. In the rare case of a hybrid Genode/Linux
component, this default can be overridden by setting 'CC_OPT_FREESTANDING' to
an empty value in the target's build-description file.

Second, the tool chain does not allow for the use of SSE4 compiler intrinsics
on x86 by default. Instead of merely enabling SSE4 via the '-msse4' compiler
argument, we decided to globally switch to the '-march=x86-64-v2' profile to
denote the processor generation with all its features as common base line.
The profile corresponds to Intel Core processors of the year 2010 or newer.


Streamlined handling of run-script preconditions
================================================

Not all run scripts are compatible with all kernels, boards, architectures, or
circumstances. Usually, such constraints had been expressed by statements
like this:

! if {![have_board pc]} {
!   puts stderr "only supported on PC hardware"
!   exit 0
! }

Over the years and with the number of run scripts growing, those preconditions
have become complex and many. Moreover, run scripts backing out because of
an unsatisfied precondition are not easy to distinguish from successful run
scripts when executed in automated fashion. Thanks to the welcome
[https://github.cokm/genodelabs/genode/issues/5432 - initiative] of Roman Iten
of [https://gapfruit.com - Gapfruit, the precondition checks for executing
run scripts have now become largely streamlined and much simpler.

The run tool has been extended by an 'assert' function that is dedicated for
expressing the preconditions of a run script. So the above example becomes:

! assert {[have_board pc]}

Note that the message can be dropped because any unsatisfied precondition
is conveniently printed in the log. However, a more instructive message can
be specified as an optional second argument.

To make this pattern as ergonomic and natural as possible, the naming of the
run tool's various checking functions have been unified and slightly extended.
The former 'get_cmd_switch' and 'get_cmd_arg' functions are now named
'have_cmd_arg' and 'cmd_arg'. A new 'have_recipe' function returns true
whenever the specified depot recipe is present. This way, the compatibility
of a run script with any board where a 'drivers_interactive' package is
defined can be expressed in a much more concise way compared to the former
enumeration of supported boards:

! assert {[have_recipe pkg/[drivers_interactive_pkg]]}

The change of the run tool is accompanied with an improvement of Genode's
autopilot tool that distinguishes unsatisfied run scripts from successfully
executed run scripts.

Thanks to Roman for this careful, tasteful, and comprehensive contribution!


Meshcmd as alternative AMT tool
===============================

We use Intel Active Management Technology (AMT) on diverse native test hardware
to forward serial output over network (SOL) to developer machines and to
power-on, reset, and power-off test machines. Since
[https://genode.org/documentation/release-notes/14.11#Improved_tooling_for_using_Intel_AMT - release 14.11]
the available tools are wsman and amttool for power-cycling and
[https://www.kraxel.org/blog/linux/amtterm/ - amtterm] for grabbing the SOL output.

With this release we added a community contribution for supporting
[https://www.meshcommander.com - meshcmd], which is
available via [https://github.com/Ylianst/MeshCommander - github] and mentioned
in release notes of
[https://www.intel.com/content/www/us/en/developer/articles/news/meshcmd-new-intel-amt-command-line-tool.html - Intel].
The tool can be used as replacement for amtterm and wsman/amttool. Beside
the known amt-tool option 'wsman' and 'amttool' now 'meshcmd' can be specified:

! RUN_OPT += --amt-tool meshcmd
